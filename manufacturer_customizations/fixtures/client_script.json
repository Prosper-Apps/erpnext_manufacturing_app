[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Job Card",
  "enabled": 1,
  "modified": "2022-07-04 14:32:20.426150",
  "name": "Job Card-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Job Card', {\n\trefresh(frm) {\n\t\tif(frm.doc.docstatus <2){\n    \t\tadd_quality_inspection(frm);\n\t\t}\n\t},\n\tbefore_submit:function(frm){\n\t    frappe.db.get_list('Quality Inspection', {\n\tfilters: {\n\t\treference_name: frm.doc.name,\n        reference_type: \"Job Card\",\n\t},\n\tfields: ['count(name) as count'],\n}).then(res => {\n\tconsole.log(res[0].count)\n\tif(res[0].count === 0){\n\t    frappe.validated=false;\n\t   frappe.msgprint(\"Quality inspection is required\");\n\t}\n});\n\n\t    $.each(frm.doc.time_logs,function(idx, row){\n\t        if(row.accepted_qty>row.completed_qty){\n\t            frappe.validate=false;\n    \t\t    frappe.throw(__(\"Time Logs <br> Row:{0} Accepted Qty should not be greater than Completed Qty.\", [idx+1]));\n\t        }\n\t        });\n\t}\n\t\n})\n\n\n\nfunction add_quality_inspection(frm){\n\tfrm.add_custom_button(__('Quality Inspection'), () => {\n\t\tfrappe.call({\n\t\t\tmethod: 'manufacturer_customizations.manufacturer_customizations.doctype.job_card.job_card.make_quality_inspection',\n\t\t\targs: {\n\t\t\t\t'doc': frm.doc\n\t\t\t},\n\t\t\tasync: false,\n\t\t\tcallback: function(r){\n\t\t\t    if(r.message)\n\t\t\t\tfrappe.set_route(\"Form\", \"Quality Inspection\", r.message);\n\t\t\t}\n\t\t})\n\t}, __('Make'));\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Work Order",
  "enabled": 1,
  "modified": "2022-07-05 15:07:45.353852",
  "name": "Work Order-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Work Order Item', {\n    length: function(frm,cdt,cdn){\n        var d = locals[cdt][cdn];\n        d.product = d.length*d.breadth\n        refresh_field(\"required_items\");\n        \n    },\n    \n    breadth: function(frm,cdt,cdn){\n        var d = locals[cdt][cdn];\n        d.product = d.length*d.breadth\n        refresh_field(\"required_items\");\n        \n    }\n})\n\nfrappe.ui.form.on('Work Order', {\n\trefresh(frm) {\n\t    \n\t    if(frm.doc.status==\"Not Started\")\n// \t\tfrm.remove_custom_button('Finish');\n\t\t\n\t\tfrm.add_custom_button(__('Quality Inspection'), function(){\n\t\t    frappe.new_doc('Quality Inspection',true)\n\t\t    frappe.route_options = {\n                reference_doctype: \"Quality Inspection\",\n                reference_type: \"Work Order\",\n                reference_name: frm.doc.name,\n                item_code: frm.doc.production_item\n            }\n            frappe.db.get_list('Quality Inspection',\n    filters={\n        'status': 'Submitted'\n    },\n    fields=['name', 'Quality Inspection.reference_type','Quality Inspection.reference_name'],\n    order_by='date desc',\n    start=10,\n    page_length=20,\n    as_list=True\n)\n        \n            // if(frm.doc.status==\"Submitted\")\n            // frm.enable_save();\n\t\t    frappe.msgprint(frm.doc.QualityInspection);\n\t\t})\n\t\t\n}\n})\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "BOM",
  "enabled": 1,
  "modified": "2022-06-27 15:49:57.388098",
  "name": "BOM-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('BOM', {\n\trefresh(frm) {\n\t\tfrm.set_query(\"item_code\", \"items\", function(doc, cdt, cdn) {\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\titem_group:\"Raw Material (BOM)\"\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t\tif(frm.doc.inspection_required==1){\n\t\t    alert('test')\n\t}\n\t},\n\tonload(frm){\n\t    frm.set_query(\"item_code\", \"items\", function(doc, cdt, cdn) {\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\titem_group:\"Raw Material (BOM)\"\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t}\n\t\n})\n\nfrappe.ui.form.on('BOM Item', {\n\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quality Inspection",
  "enabled": 1,
  "modified": "2022-07-05 10:22:47.814766",
  "name": "Quality Inspection-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Quality Inspection', {\n\tset_default(frm) {\n\t    if(frm.doc.set_default == 1){\n\t        $.each(frm.doc.readings,function(idx, item){\n\t            if(item.specification == 'Hole Profile'){\n\t                item.mesured_observed = 'Hole profiles are good'\n\t            }\n\t            else if(item.specification == 'Bow, Twist & Wrap'){\n\t                item.mesured_observed = 'Within acceptable limit'\n\t            }\n\t            else if(item.specification == 'Solder Mask - Hardness'){\n\t                item.mesured_observed = 'Passed'\n\t            }\n\t            else if(item.specification == 'Min Trace width / space'){\n\t                item.mesured_observed = 'Measured and Found Ok'\n\t            }\n\t            else if(item.specification == 'Solderability HASL/ENiG/Hard Gold'){\n\t                item.mesured_observed = 'Good'\n\t            }\n\t            else if(item.specification == 'General Aesthatic'){\n\t                item.mesured_observed = 'Free from scratches and dust'\n\t            }\n\t            else if(item.specification == 'Electrical Test'){\n\t                item.mesured_observed = 'Passed'\n\t            }\n\t        });\n\t        refresh_field(\"readings\");\n\t    }\n\t   // on_submit:(frm){\n\t   // frappe.ui.form.on('Work Order', {\n\t   // refresh(frm) {\n\t    frappe.route_options = {\n                reference_doctype: \"Work Order\",\n                reference_type: \"Work Order\",\n                final_qty: frm.doc.order_qty\n            }\n\t   // }\n\t\n\t   // })\n\t},\n})",
  "view": "Form"
 }
]